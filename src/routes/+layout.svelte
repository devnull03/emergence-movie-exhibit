<script lang="ts">
  import "../app.css";
  import { onMount, onDestroy } from "svelte";
  import { fade, fly } from "svelte/transition";
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/all";

  import {
    Header,
    Footer,
  } from "@south-asian-canadian-digital-archive/sacda-exhibits-common";

  import SubHeader from "$lib/components/SubHeader.svelte";
  import SubFooter from "$lib/components/SubFooter.svelte";
  import Cursor from "$lib/components/Cursor.svelte";

  import shareThis, { type ShareThisInstance } from "share-this";
  import * as twitterSharer from "share-this/dist/sharers/twitter";
  import * as redditSharer from "share-this/dist/sharers/reddit";
  import * as facebookSharer from "share-this/dist/sharers/facebook";
  import * as emailSharer from "share-this/dist/sharers/email";

  interface Props {
    children?: import("svelte").Snippet;
  }

  let scrollY = $state(0);
  let { children }: Props = $props();

  let firstLoad = $state(true);
  // let load = $derived(firstLoad || !$navigating);

  const siteData = {
    description: "",
    keywords: [],
    placename: "",
    region: "",
  };

  let selectionShare: ShareThisInstance | undefined = $state();

  onMount(() => {
    // gsap.registerPlugin(ScrollTrigger);

    selectionShare = shareThis({
      selector: "#smooth-wrapper",
      popoverClass: "custom-share-popover",
      sharers: [twitterSharer, facebookSharer, redditSharer, emailSharer],
    });

    selectionShare.init();

    // ScrollTrigger.create({
    //   trigger: "#subheader",
    //   pin: true,
    //   start: "top",
    //   end: "max",
    //   pinType: "fixed",
    //   pinSpacing: false,
    // });

    firstLoad = false;
  });

  onDestroy(() => {
    selectionShare?.destroy();
  });
</script>

<svelte:head>
  <title>SACDA - Emergence Documentary Exhibit</title>

  <script
    src="https://kit.fontawesome.com/30f055fc02.js"
    crossorigin="anonymous"
  ></script>

  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="SACDA Exhibit" />
  <link rel="manifest" href="/site.webmanifest" />

  <meta name="description" content={siteData.description} />
  <meta name="keywords" content={siteData.keywords.join(", ")} />
  <meta
    property="og:title"
    content="Emergence: Out of the Shadows - SACDA Exhibit"
  />
  <meta property="og:description" content={siteData.description} />
  <meta property="og:image" content="/favicon-96x96.png" />
  <meta property="og:url" content="https://emergence.sacda.ca" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta
    name="twitter:title"
    content="Emergence: Out of the Shadows - SACDA Exhibit"
  />
  <meta name="twitter:description" content={siteData.description} />
  <meta name="twitter:image" content="/favicon-96x96.png" />

  <meta name="author" content="South Asian Canadian Digital Archive" />
  <meta name="geo.placename" content={siteData.placename} />
  <meta name="geo.region" content={siteData.region} />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    rel="preconnect"
    href="https://fonts.gstatic.com"
    crossorigin="anonymous"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet"
  />
</svelte:head>

<svelte:window bind:scrollY />

<Cursor />

<div class="h-full w-full">
  <Header />

  <SubHeader />

  <div class="-mt-16 mb-[400px]">
    {@render children?.()}
  </div>

  <div class="fixed bottom-0 z-[-1] w-full">
    <SubFooter />
    <Footer />
  </div>
</div>

<!-- Floating Play Button -->
<button
  class="group fixed right-6 z-[1000] rounded-full bg-red-600 object-cover py-0.5 shadow-lg transition-all duration-500 hover:-translate-y-1 hover:bg-red-700"
  class:bottom-6={scrollY === 0}
  class:bottom-22={scrollY !== 0}
  aria-label="Watch Now"
  onclick={() => {
    gsap.to(window, {
      duration: 1,
      scrollTo: {
        y: "#watch-now",
        autoKill: false,
      },
      ease: "power2.inOut",
    });
  }}
>
  <span
    class="fa fa-play px-5 py-4 text-white transition-all duration-500 group-hover:scale-110"
  ></span>
</button>

{#if scrollY !== 0}
  <button
    transition:fly={{ y: 10, duration: 500 }}
    class="group fixed bottom-6 right-6 z-999 rounded-full bg-[#f49d2d] object-cover py-0.5 shadow-lg transition-all duration-500 hover:-translate-y-1"
    aria-label="yuh"
    onclick={() => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }}
  >
    <span
      class="fa fa-angle-left rotate-90 px-5 py-4 text-white transition-all duration-500 group-hover:scale-110"
    ></span>
  </button>
{/if}
